<!DOCTYPE html>
<html lang="es" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
	<meta charset="utf-8">
	<title>Panel Administrativo - MoviXpress</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
	<style>
		body {
			background-color: #f8fafc;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}
		
		/* ========== SIDEBAR ========== */
		.sidebar {
			width: 280px;
			height: 100vh;
			position: fixed;
			top: 0;
			left: 0;
			background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
			color: #fff;
			transition: all 0.3s;
			z-index: 1000;
			overflow-y: auto;
		}
		
		.sidebar-header {
			padding: 1.5rem 1rem;
			background-color: rgba(15, 23, 42, 0.6);
			border-bottom: 1px solid rgba(148, 163, 184, 0.1);
		}

		.sidebar-header a {
			padding: 0.5rem;
			border-radius: 8px;
			transition: all 0.3s ease;
		}

		.sidebar-header a:hover {
			background: rgba(59, 130, 246, 0.1);
		}

		/* Tarjeta de Datos Personales - MEJORADA */
		.sidebar a[href="/usuario/perfil"] {
			background: rgba(59, 130, 246, 0.1) !important;
			border: 1px solid rgba(59, 130, 246, 0.3) !important;
			transition: all 0.3s ease;
			backdrop-filter: blur(10px);
			border-radius: 12px !important;
		}

		.sidebar a[href="/usuario/perfil"]:hover {
			background: rgba(59, 130, 246, 0.15) !important;
			border-color: rgba(59, 130, 246, 0.5) !important;
			transform: translateX(4px);
		}

		/* Enlaces de navegación mejorados */
		.sidebar .nav-link {
			border-radius: 8px;
			margin-bottom: 4px;
			transition: all 0.2s ease;
			color: #cbd5e1 !important;
			padding: 0.75rem 1rem;
		}

		.sidebar .nav-link:hover {
			background-color: rgba(59, 130, 246, 0.15) !important;
			color: #fff !important;
			transform: translateX(4px);
		}

		.sidebar .nav-link.active {
			background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%) !important;
			color: #fff !important;
			font-weight: 600;
			box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
		}

		/* Submenús mejorados */
		.btn-toggle-nav .nav-link {
			padding: 0.625rem 1rem;
			font-size: 0.9rem;
		}

		/* Iconos de chevron con animación */
		.nav-link[data-bs-toggle="collapse"] .bi-chevron-down {
			transition: transform 0.3s ease;
		}

		.nav-link[data-bs-toggle="collapse"]:not(.collapsed) .bi-chevron-down {
			transform: rotate(180deg);
		}

		/* Scrollbar del sidebar personalizado */
		.sidebar::-webkit-scrollbar {
			width: 6px;
		}
		.sidebar::-webkit-scrollbar-track {
			background: rgba(15, 23, 42, 0.3);
		}
		.sidebar::-webkit-scrollbar-thumb {
			background: rgba(148, 163, 184, 0.3);
			border-radius: 3px;
		}
		.sidebar::-webkit-scrollbar-thumb:hover {
			background: rgba(148, 163, 184, 0.5);
		}

		/* ========== MAIN CONTENT ========== */
		.main-content {
			margin-left: 280px;
			transition: all 0.3s;
		}
		
		/* ========== HEADER ========== */
		.top-header {
			background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
			padding: 1rem 1.5rem;
			position: sticky;
			top: 0;
			z-index: 999;
			border-bottom: 1px solid #e2e8f0;
		}

		/* Badge mejorado */
		.badge.bg-success {
			background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
			padding: 0.35rem 0.65rem;
			font-weight: 500;
			box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
		}

		/* Dropdown usuario */
		.dropdown-toggle::after {
			transition: transform 0.3s ease;
		}

		.dropdown.show .dropdown-toggle::after {
			transform: rotate(180deg);
		}
		
		/* ========== SCROLLBAR GENERAL ========== */
		::-webkit-scrollbar {
			width: 8px;
		}
		::-webkit-scrollbar-track {
			background: #f1f5f9;
		}
		::-webkit-scrollbar-thumb {
			background: #94a3b8;
			border-radius: 4px;
		}
		::-webkit-scrollbar-thumb:hover {
			background: #64748b;
		}

		/* ========== LOADER STYLES ========== */
		#loader-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.7);
			z-index: 9999;
			display: flex;
			justify-content: center;
			align-items: center;
			transition: opacity 0.3s ease-out;
		}

		.loader {
			width: 48px;
			height: 48px;
			border: 5px solid #FFF;
			border-bottom-color: transparent;
			border-radius: 50%;
			display: inline-block;
			box-sizing: border-box;
			animation: rotation 1s linear infinite;
		}

		@keyframes rotation {
			0% {
				transform: rotate(0deg);
			}
			100% {
				transform: rotate(360deg);
			}
		}

		.loader-hidden {
			opacity: 0;
			pointer-events: none;
		}

		/* ========== RESPONSIVE ========== */
		@media (max-width: 768px) {
			.sidebar {
				transform: translateX(-100%);
			}
			
			.sidebar.show {
				transform: translateX(0);
			}
			
			.main-content {
				margin-left: 0;
			}
		}
	</style>
</head>

<body>

	<!-- Loader -->
	<div id="loader-overlay">
		<div class="loader"></div>
	</div>

	<!-- Sidebar -->
	<nav class="sidebar">
		<div class="sidebar-header">
			<a href="/" class="d-flex align-items-center mb-0 text-white text-decoration-none fs-4 fw-bold">
				<img src="\images\movixpressfull-logo.svg" alt="Logo MoviXpress" style="max-height: 40px;" class="mb-2">
			</a>
		</div>
		
		<div class="p-3">
			<!-- User Profile Card - MEJORADO -->
			<a href="/usuario/perfil"
				class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none p-2">
				<img th:src="@{${fotoUsuario}}" class="rounded-circle me-2" alt="Foto" width="32" height="32"
					onerror="this.onerror=null; this.src='/images/default-user.png';">
				<span class="fs-6">Datos personales</span>
			</a>

			<ul class="nav nav-pills flex-column mb-auto mt-3">

				<!-- Administración con ícono desplegable -->
				<li th:if="${rolUsuario == 'ROLE_ADMIN'}">
					<a class="nav-link text-white d-flex justify-content-between align-items-center collapsed"
						data-bs-toggle="collapse" href="#adminSubmenu" role="button" aria-expanded="false"
						aria-controls="adminSubmenu">
						<span><i class="bi bi-gear me-2"></i>Administración</span>
						<i class="bi bi-chevron-down"></i>
					</a>
					<div class="collapse ps-3" id="adminSubmenu" th:classappend="${#strings.contains(currentUri, '/usuarios') or #strings.contains(currentUri, '/monedas') or #strings.contains(currentUri, '/configuracion')} ? 'show'">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="/usuarios/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/usuarios')} ? 'active'"><i
										class="bi bi-people me-2"></i>Usuarios</a></li>
							<li><a href="/monedas/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/monedas')} ? 'active'"><i
										class="bi bi-currency-exchange me-2"></i>Monedas</a></li>
							<li><a href="/configuracion/" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/configuracion')} ? 'active'"><i
										class="bi bi-sliders me-2"></i>Configuración</a></li>
						</ul>
					</div>
				</li>

				<li><a href="/clientes/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/clientes')} ? 'active'"><i
							class="bi bi-person-lines-fill me-2"></i>Clientes</a></li>
				<li><a href="/documentos/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/documentos')} ? 'active'"><i
							class="bi bi-file-earmark-text me-2"></i>Documentos</a></li>

				<!-- Vehículos con ícono desplegable -->
				<li>
					<a class="nav-link text-white d-flex justify-content-between align-items-center collapsed"
						data-bs-toggle="collapse" href="#vehiculosSubmenu" role="button" aria-expanded="false"
						aria-controls="vehiculosSubmenu">
						<span><i class="bi bi-truck-front me-2"></i>Vehículos</span>
						<i class="bi bi-chevron-down"></i>
					</a>
					<div class="collapse ps-3" id="vehiculosSubmenu"
					th:classappend="${#strings.contains(currentUri, '/marcas') or #strings.contains(currentUri, '/tipos') or #strings.contains(currentUri, '/vehiculos')} ? 'show'">
						<ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
							<li><a href="/marcas/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/marcas')} ? 'active'"><i
										class="bi bi-badge-ad me-2"></i>Marcas</a></li>
							<li><a href="/tipos/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/tipos')} ? 'active'"><i
										class="bi bi-tags me-2"></i>Tipos</a></li>
							<li><a href="/vehiculos/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/vehiculos')} ? 'active'"><i
										class="bi bi-car-front me-2"></i>Vehículos</a></li>
						</ul>
					</div>
				</li>

				<li><a href="/alquiler/listado" class="nav-link text-white" th:classappend="${#strings.contains(currentUri, '/alquiler')} ? 'active'"><i
							class="bi bi-calendar-check me-2"></i>Alquiler de Vehículos</a></li>
				<li><a href="#" class="nav-link text-white"><i class="bi bi-clipboard-data me-2"></i>Reporte
						Préstamo</a></li>
			</ul>
		</div>
	</nav>

	<!-- Main Content Wrapper -->
	<div class="main-content">
		<!-- Top Header -->
		<header class="top-header d-flex justify-content-between align-items-center">
			<h5 class="m-0 text-secondary fw-bold">Panel de Control</h5>
			
			<div class="d-flex align-items-center gap-3">
				<div class="dropdown text-end">
					<a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle"
						id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
						<span class="badge me-2 bg-success">En línea</span>
						<img th:src="@{${fotoUsuario}}" class="rounded-circle me-2" alt="Foto" width="32"
							height="32" onerror="this.onerror=null; this.src='/images/default-user.png';">
					</a>
					<ul class="dropdown-menu dropdown-menu-dark text-small" aria-labelledby="dropdownUser1">
						<li><a class="dropdown-item" href="/usuario/perfil">Profile</a></li>
						<li>
							<hr class="dropdown-divider">
						</li>
						<li>
							<a class="dropdown-item" href="#"
								onclick="document.getElementById('logoutForm').submit(); return false;">
								Sign out
							</a>
							<form id="logoutForm" th:action="@{/logout}" method="post" style="display: none;">
							</form>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<!-- Page Content -->
		<div class="container-fluid p-4" layout:fragment="content">
			<!-- Tu contenido aquí -->
		</div>
	</div>


	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
		crossorigin="anonymous"></script>
	<script th:src="@{/js/scrips.js}" defer></script>
	
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	
	<script th:if="${mensaje != null}">
		Swal.fire({
			icon: '[[${tipoMensaje}]]',
			title: 'Mensaje',
			text: '[[${mensaje}]]',
			confirmButtonColor: '#dc3545'
		});
	</script>
		
	<script th:src="@{/js/sweet-alert-confirmation.js}" defer></script>

	<script>
		window.addEventListener('load', function () {
			const loader = document.getElementById('loader-overlay');
			loader.classList.add('loader-hidden');
			setTimeout(() => {
				loader.style.display = 'none';
			}, 300);
		});

		// Show loader on navigation
		document.addEventListener('click', function (e) {
			const target = e.target.closest('a');
			if (target) {
				const href = target.getAttribute('href');
				const targetAttr = target.getAttribute('target');
				const isToggle = target.getAttribute('data-bs-toggle');

				if (href &&
					!href.startsWith('#') &&
					!href.startsWith('javascript') &&
					targetAttr !== '_blank' &&
					!isToggle) {

					const loader = document.getElementById('loader-overlay');
					loader.style.display = 'flex';
					loader.classList.remove('loader-hidden');
				}
			}
		});

		// Show loader on form submit
		document.addEventListener('submit', function (e) {
			const loader = document.getElementById('loader-overlay');
			loader.style.display = 'flex';
			loader.classList.remove('loader-hidden');
		});
	</script>

</body>

</html>